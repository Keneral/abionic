
# END USER LICENCE AGREEMENT FOR THE SOFTWARE PACKAGE (“Software”)
THIS END USER LICENCE AGREEMENT (“LICENCE”) IS A LEGAL AGREEMENT BETWEEN YOU (EITHER A SINGLE INDIVIDUAL, OR SINGLE LEGAL ENTITY) AND INFINIX INC., ("INFINIX") FOR THE USE OF THE SOFTWARE ACCOMPANYING THIS LICENCE. INFINIX IS ONLY WILLING TO LICENSE THE SOFTWARE TO YOU ON CONDITION THAT YOU ACCEPT ALL OF THE TERMS IN THIS LICENCE. BY CLICKING “I AGREE” OR BY INSTALLING OR OTHERWISE USING OR COPYING THE SOFTWARE YOU INDICATE THAT YOU AGREE TO BE BOUND BY ALL OF THE TERMS OF THIS LICENCE. IF YOU DO NOT AGREE TO THE TERMS OF THIS LICENCE, INFINIX IS UNWILLING TO LICENSE THE SOFTWARE TO YOU AND YOU MAY NOT INSTALL, USE OR COPY THE SOFTWARE, AND YOU SHOULD PROMPTLY RETURN THE SOFTWARE TO YOUR SUPPLIER.
“Applications” means applications for use solely in conjunction with INFINIX’s wireless communication platforms and/or products.
“Output” means data resulting from your use of the Software and all direct and indirect derivatives thereof.
“Software” means any software, firmware and data accompanying this Licence, any printed, electronic or online documentation supplied with it under the terms of this Licence for the Software.
# 1. LICENCE GRANTS TO YOU
1.1 INFINIX hereby grants to you, subject to the terms and conditions of this Licence, a non-exclusive, non-transferable, non-sublicensable, revocable, royalty-free and limited license to: 1. use and copy the Software or certain components or optional functionality in the Software, as applicable, solely for the purposes of internally running, designing or developing Applications
# 2. RESTRICTIONS ON USE OF THE SOFTWARE
BENCHMARKING: This Licence does not prevent you from using the Software for benchmarking purposes. However, you shall ensure that any and all benchmarking data relating to the Software, and any other results of your use or testing of the Software which are indicative of its performance, efficacy, reliability or quality, shall not be used to disparage INFINIX, its products or services, or in a manner that, in INFINIX’s reasonable judgment, may diminish or otherwise damage the reputation of INFINIX. Except as specified in this License, you shall not: (i) modify or create any derivative works of the Software; (ii) decompile, disassemble, or reverse engineer the Software (iii) redistribute, encumber, sell, rent, lease, sublicense, or otherwise transfer rights to the Software except as set forth in this License; or (iv) remove or alter any trademark, logo, copyright or other proprietary notices, legends, symbols or labels in the Software. COPYRIGHT AND RESERVATION OF RIGHTS: The Software is owned by INFINIX or its licensors and is protected by copyright and other intellectual property laws and international treaties. The Software is licensed not sold. You acquire no rights to the Software other than as expressly provided by this Licence. You shall not remove from the Software any copyright notice or other notice and shall ensure that any such notice is reproduced in any copies of the whole or any part of the Software made by you or other permitted users.
REVERSE ENGINEERING: Except to the extent that such activity is permitted by applicable law you shall not reverse engineer, decompile or disassemble any of the Software. If the Software was provided to you in Europe you shall not reverse engineer, decompile or disassemble any of the Software for the purposes of error correction.
RESTRICTED USE You agree that you shall not use the Software or the Output other than pursuant to and in accordance with the exercise of any of the licences granted under this Licence. Without limiting the generality of the foregoing, you shall not use the Software or any Output: (a) for determining if any features, functions or processes provided by the Software are covered by any patents or patent applications owned by you or a third party; or (b) for developing technology, applications or products which avoid any of INFINIX’s intellectual property in the Software licensed hereunder; or (c) as a reference for modifying existing patents or patent applications or creating any continuation, continuation in part, or extension of existing patents or patent applications.
# 3. CONFIDENTIAL INFORMATION
Confidential Information shall mean: (a) the Software; and (b) Information disclosed by INFINIX to you in any other manner that is identified as confidential at the time of disclosure and summarized and designated as confidential in a written memorandum delivered to you within thirty (30) days of the disclosure.
Confidential Information shall not include information which: (a) is or becomes public knowledge through no fault of the recipient; (b) was in your possession before receipt from the party providing such Confidential Information; (c) is rightfully received by the receiving party from a third party without any duty of confidentiality; (d) is disclosed to a third party by INFINIX providing the Confidential Information without a duty of confidentiality on the third party; (e) is independently developed by you without reference of Confidential Information ; (f) is disclosed under operation of law; or (g) is disclosed with the prior written approval of INFINIX providing such Confidential Information.
INFINIX shall retain all Intellectual Property Rights in any Confidential Information disclosed to you. You agree, both during the term of this License and for a period of three (3) years after termination or expiration of this License, to hold INFINIX's Confidential Information in confidence and to protect the disclosed Confidential Information by using the same degree of care to prevent the unauthorized use, dissemination or publication of the Confidential Information as they use to protect their own confidential information of a like nature, but no less than reasonable care. You acknowledge that any disclosure, use or misappropriation of Confidential Information in violation of this License would cause INFINIX irreparable harm for which there may be no adequate remedy at law. Accordingly, you agree that INFINIX shall have the right to apply to any court of competent jurisdiction for injunctive relief and specific performance, without prejudice to any remedies otherwise available to INFINIX at law or in equity.
# 4. SUPPORT
INFINIX is not under an obligation to provide support, but it may do so at its own discretion, and if it does, it will only be in respect of the Software as delivered.
# 5. NO WARRANTIES
YOU AGREE THAT THE SOFTWARE IS LICENSED “AS IS”, AND THAT INFINIX EXPRESSLY DISCLAIMS ALL REPRESENTATIONS, WARRANTIES, CONDITIONS OR OTHER TERMS, EXPRESS OR IMPLIED OR STATUTORY, INCLUDING WITHOUT LIMITATION THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, SATISFACTORY QUALITY, AND FITNESS FOR A PARTICULAR PURPOSE.
INFINIX SHALL NOT BE RESPONSIBLE FOR ANY SOFTWARE RELEASES MADE TO YOUR SPECIFICATION OR CONFORMING TO A PARTICULAR STANDARD OR OPEN FORUM. FURTHER, INFINIX DOES NOT REPRESENT OR WARRANT THAT ANY PORTION OF THE SOFTWARE IS FREE OF INACCURACIES, ERRORS, BUGS OR INTERRUPTIONS, OR IS RELIABLE, ACCURATE, COMPLETE, OR OTHERWISE VALID. YOUR USE OR OPERATION OF THE SOFTWARE IS AT YOUR OWN DISCRETION AND RISK. YOU HEREBY ACKNOWLEDGES THAT THE SOFTWARE PROVIDED UNDER THE LICENSE MIGHT INCLUDE SOFTWARE FROM ONE OR MORE THIRD PARTIES (E.G. OPEN SOURCE OR PROPRIETARY, COLLECTIVELY AS “THIRD PARTY SOFTWARE”) AND THE USE OF SUCH SHALL BE IN ACCORDANCE WITH THE TERMS AND CONDITIONS OF THE LICENSE UNLESS OTHERWISE SPECIFIED IN THE THIRD PARTY SOFTWARE LICENSE AGREEMENT ACCOMPANYING SUCH THIRD PARTY SOFTWARE. YOU EXPRESSLY ACKNOWLEDGE THAT IT YOUR SOLE RESPONSIBILITY TO OBTAIN FROM ANY THIRD PARTY ALL PROPER LICENSES CONTAINED IN THE SOFTWARE. NOTWITHSTANDING ANY WARRANTY SET FORTH UNDER THIS LICENSE TO THE CONTRARY, INFINIX HEREBY EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES, EXPRESS OR IMPLIED, TO THE EXTENT ALLOWED BY APPLICABLE LAWS, WITH RESPECT TO ANY THIRD PARTY SOFTWARE.
# 6. LIMITATION OF LIABILITY
TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT SHALL INFINIX BE LIABLE FOR ANY INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES (INCLUDING LOSS OF PROFITS) ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE WHETHER BASED ON A CLAIM UNDER CONTRACT, TORT OR OTHER LEGAL THEORY, EVEN IF INFINIX WAS ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
NOTWITHSTANDING ANYTHING TO THE CONTRARY CONTAINED IN THIS LICENCE, THE MAXIMUM LIABILITY OF INFINIX TO YOU IN AGGREGATE FOR ALL CLAIMS MADE AGAINST INFINIX IN CONTRACT TORT OR OTHERWISE UNDER OR IN CONNECTION WITH THE SUBJECT MATTER OF THIS LICENCE SHALL NOT EXCEED (I) THE TOTAL OF SUMS PAID BY YOU TO INFINIX (IF ANY) FOR THIS LICENCE. THE EXISTENCE OF MORE THAN ONE CLAIM WILL NOT ENLARGE OR EXTEND THE LIMIT.
# 7. EXPORT COMPLIANCE
YOU ACKNOWLEDGE THAT SOFTWARE MAY BE SUBJECT TO THE LAWS AND REGULATIONS OF RELATED JURISDICTIONS, INCLUDING U.K., EUROPEAN UNION, AND U.S. EXPORT CONTROL LAWS AND REGULATIONS, AND INCLUDING THE U.S. EXPORT ADMINISTRATION ACT AND ITS ASSOCIATED REGULATIONS, GOVERNING THE EXPORT, RE-EXPORT OR IMPORT OF CONTROL COMMODITIES. YOU SHALL NOT EXPORT, RE-EXPORT, IMPORT OR OTHERWISE SELL, TRANSFER, DIRECTLY OR INDIRECTLY, SOFTWARE OBTAINED HEREUNDER EXCEPT IN STRICT COMPLIANCE WITH ALL SUCH APPLICABLE LAWS AND REGULATIONS. YOU EXPRESSLY AGREE THAT SOFTWARE SHALL NOT BE DOWNLOADED OR OTHERWISE EXPORTED OR RE-EXPORTED INTO (OR TO A NATIONAL OR RESIDENT OF) ANY EMBARGOED COUNTRIES, NOR TO ANYONE ON RELATED DENIAL LISTS, INCLUDING BUT NOT LIMITED TO THE U.S. TREASURY DEPARTMENT’S LIST OF SPECIALLY DESIGNATED NATIONALS OR THE U.S. COMMERCE DEPARTMENT’S TABLE OF DENIAL ORDERS. YOU HEREBY REPRESENT AND WARRANT THAT IT IS NOT LOCATED IN, UNDER THE CONTROL OF, OR A NATIONAL OR RESIDENT OF, ANY SUCH COUNTRY, OR ON ANY SUCH LIST. WITHOUT LIMITING THE FOREGOING, YOU AGREE THAT SOFTWARE PROVIDED HEREUNDER SHALL NOT BE EXPORTED, RE-EXPORTED, OR TRANSFERRED BY YOU TO ANY END-USER ENGAGED IN ACTIVITIES, OR FOR ANY END-USE, DIRECTLY OR INDIRECTLY RELATED TO THE DESIGN, DEVELOPMENT, PRODUCTION, USE, OR STOCKPILING OF WEAPONS OF MASS DESTRUCTION (E.G., NUCLEAR, CHEMICAL, OR BIOLOGICAL WEAPONS, AND THE MISSILE TECHNOLOGY TO DELIVER THEM).
# 8. U.S. GOVERNMENT END USERS
US Government Restrictions: Use, duplication, reproduction, release, modification, disclosure or transfer of the Software is restricted in accordance with the terms of this Licence.
# 9. TERM AND TERMINATION
This Licence shall remain in force until terminated by INFINIX. Without prejudice to any of its other rights if you are in breach of any of the terms and conditions of this Licence then INFINIX may terminate this Licence immediately upon giving written notice to you or on thirty (30) days written notice without cause. INFINIX may terminate this Licence at any time. Upon termination of this Licence by INFINIX , you shall stop using the Software and destroy all copies of the Software in your possession, together with all documentation and related materials. The provisions of clauses 2, 3, 5, 6, 7, 8, 9 and 10 shall survive termination of this Licence.
# 10. GENERAL
This License is governed and interpreted in accordance with the laws of the Republic of China without regard to any conflict of laws provisions. Except where INFINIX agrees otherwise in: (i) a written contract signed by you and INFINIX; or (ii) a written contract provided by INFINIX and accepted by you, this is the only agreement between you and INFINIX relating to the Software and it may only be modified by written agreement between you and INFINIX. If any clause or sentence in this Licence is held by a court of law to be illegal or unenforceable the remaining provisions of this Licence shall not be affected thereby. The failure by INFINIX to enforce any of the provisions of this Licence, unless waived in writing, shall not constitute a waiver of INFINIX's rights to enforce such provision or any other provision of this Licence in the future.
At INFINIX’s request, you agree to check your computers for installations of the Software and any other information requested by INFINIX relating to Software installation and to provide this information to INFINIX. You agree that auditors nominated by INFINIX may also perform such checking and reporting on behalf of INFINIX by prior appointment during your normal business hours on seven (7) days’ notice. INFINIX shall bear the auditors’ costs for that audit unless it reveals unlicensed usage in which case you shall promptly reimburse INFINIX for all reasonable costs and expenses, including professional fees, relating to such audit. Any information which is disclosed to INFINIX or such auditors during checking or audit shall be treated as your confidential information and shall only be used by INFINIX for licence management, compliance and enforcement purposes.
You may not assign this License, in whole or in part, without INFINIX’s prior written consent, and any attempt to do so without such consent shall be void. INFINIX may assign this License without your consent. This License shall be binding upon and shall inure to the benefit of the parties hereto and their respective successors and permitted assigns. Any Change of Control event shall be deemed an assignment requiring INFINIX’s prior written consent under this License. Subject to the foregoing, all of the rights and obligations of you under this License will bind and inure to the benefit of your respective successors and permitted assigns. For the purpose of clarification, “Change of Control” means shall mean (i) a change in more than fifty percent (50%) in voting or common share ownership or change in actual control over board of directors’ decisions; or (ii) a sale of all or substantially all assets of a party. This License will not be construed as creating an agency, partnership, joint venture, fiduciary duty, or any other form of legal relationship between INFINIX and you, and you must not represent the existence of any such relationship, whether expressly, by implication or otherwise
Working on bionic
=================

What are the big pieces of bionic?
----------------------------------

#### libc/ --- libc.so, libc.a

The C library. Stuff like `fopen(3)` and `kill(2)`.

#### libm/ --- libm.so, libm.a

The math library. Traditionally Unix systems kept stuff like `sin(3)` and
`cos(3)` in a separate library to save space in the days before shared
libraries.

#### libdl/ --- libdl.so

The dynamic linker interface library. This is actually just a bunch of stubs
that the dynamic linker replaces with pointers to its own implementation at
runtime. This is where stuff like `dlopen(3)` lives.

#### libstdc++/ --- libstdc++.so

The C++ ABI support functions. The C++ compiler doesn't know how to implement
thread-safe static initialization and the like, so it just calls functions that
are supplied by the system. Stuff like `__cxa_guard_acquire` and
`__cxa_pure_virtual` live here.

#### linker/ --- /system/bin/linker and /system/bin/linker64

The dynamic linker. When you run a dynamically-linked executable, its ELF file
has a `DT_INTERP` entry that says "use the following program to start me".  On
Android, that's either `linker` or `linker64` (depending on whether it's a
32-bit or 64-bit executable). It's responsible for loading the ELF executable
into memory and resolving references to symbols (so that when your code tries to
jump to `fopen(3)`, say, it lands in the right place).

#### tests/ --- unit tests

The `tests/` directory contains unit tests. Roughly arranged as one file per
publicly-exported header file.

#### benchmarks/ --- benchmarks

The `benchmarks/` directory contains benchmarks.


What's in libc/?
----------------

<pre>
libc/
  arch-arm/
  arch-arm64/
  arch-common/
  arch-mips/
  arch-mips64/
  arch-x86/
  arch-x86_64/
    # Each architecture has its own subdirectory for stuff that isn't shared
    # because it's architecture-specific. There will be a .mk file in here that
    # drags in all the architecture-specific files.
    bionic/
      # Every architecture needs a handful of machine-specific assembler files.
      # They live here.
    include/
      machine/
        # The majority of header files are actually in libc/include/, but many
        # of them pull in a <machine/something.h> for things like limits,
        # endianness, and how floating point numbers are represented. Those
        # headers live here.
    string/
      # Most architectures have a handful of optional assembler files
      # implementing optimized versions of various routines. The <string.h>
      # functions are particular favorites.
    syscalls/
      # The syscalls directories contain script-generated assembler files.
      # See 'Adding system calls' later.

  include/
    # The public header files on everyone's include path. These are a mixture of
    # files written by us and files taken from BSD.

  kernel/
    # The kernel uapi header files. These are scrubbed copies of the originals
    # in external/kernel-headers/. These files must not be edited directly. The
    # generate_uapi_headers.sh script should be used to go from a kernel tree to
    # external/kernel-headers/ --- this takes care of the architecture-specific
    # details. The update_all.py script should be used to regenerate bionic's
    # scrubbed headers from external/kernel-headers/.

  private/
    # These are private header files meant for use within bionic itself.

  dns/
    # Contains the DNS resolver (originates from NetBSD code).

  upstream-freebsd/
  upstream-netbsd/
  upstream-openbsd/
    # These directories contain unmolested upstream source. Any time we can
    # just use a BSD implementation of something unmodified, we should.
    # The structure under these directories mimics the upstream tree,
    # but there's also...
    android/
      include/
        # This is where we keep the hacks necessary to build BSD source
        # in our world. The *-compat.h files are automatically included
        # using -include, but we also provide equivalents for missing
        # header/source files needed by the BSD implementation.

  bionic/
    # This is the biggest mess. The C++ files are files we own, typically
    # because the Linux kernel interface is sufficiently different that we
    # can't use any of the BSD implementations. The C files are usually
    # legacy mess that needs to be sorted out, either by replacing it with
    # current upstream source in one of the upstream directories or by
    # switching the file to C++ and cleaning it up.

  malloc_debug/
    # The code that implements the functionality to enable debugging of
    # native allocation problems.

  stdio/
    # These are legacy files of dubious provenance. We're working to clean
    # this mess up, and this directory should disappear.

  tools/
    # Various tools used to maintain bionic.

  tzcode/
    # A modified superset of the IANA tzcode. Most of the modifications relate
    # to Android's use of a single file (with corresponding index) to contain
    # time zone data.
  zoneinfo/
    # Android-format time zone data.
    # See 'Updating tzdata' later.
</pre>


Adding system calls
-------------------

Adding a system call usually involves:

  1. Add entries to SYSCALLS.TXT.
     See SYSCALLS.TXT itself for documentation on the format.
  2. Run the gensyscalls.py script.
  3. Add constants (and perhaps types) to the appropriate header file.
     Note that you should check to see whether the constants are already in
     kernel uapi header files, in which case you just need to make sure that
     the appropriate POSIX header file in libc/include/ includes the
     relevant file or files.
  4. Add function declarations to the appropriate header file.
  5. Add at least basic tests. Even a test that deliberately supplies
     an invalid argument helps check that we're generating the right symbol
     and have the right declaration in the header file. (And strace(1) can
     confirm that the correct system call is being made.)


Updating kernel header files
----------------------------

As mentioned above, this is currently a two-step process:

  1. Use generate_uapi_headers.sh to go from a Linux source tree to appropriate
     contents for external/kernel-headers/.
  2. Run update_all.py to scrub those headers and import them into bionic.


Updating tzdata
---------------

This is fully automated (and these days handled by the libcore team, because
they own icu, and that needs to be updated in sync with bionic):

  1. Run update-tzdata.py in external/icu/tools/.


Verifying changes
-----------------

If you make a change that is likely to have a wide effect on the tree (such as a
libc header change), you should run `make checkbuild`. A regular `make` will
_not_ build the entire tree; just the minimum number of projects that are
required for the device. Tests, additional developer tools, and various other
modules will not be built. Note that `make checkbuild` will not be complete
either, as `make tests` covers a few additional modules, but generally speaking
`make checkbuild` is enough.


Running the tests
-----------------

The tests are all built from the tests/ directory.

### Device tests

    $ mma
    $ adb remount
    $ adb sync
    $ adb shell /data/nativetest/bionic-unit-tests/bionic-unit-tests32
    $ adb shell \
        /data/nativetest/bionic-unit-tests-static/bionic-unit-tests-static32
    # Only for 64-bit targets
    $ adb shell /data/nativetest64/bionic-unit-tests/bionic-unit-tests64
    $ adb shell \
        /data/nativetest64/bionic-unit-tests-static/bionic-unit-tests-static64

### Host tests

The host tests require that you have `lunch`ed either an x86 or x86_64 target.

    $ mma
    $ mm bionic-unit-tests-run-on-host32
    $ mm bionic-unit-tests-run-on-host64  # For 64-bit *targets* only.

### Against glibc

As a way to check that our tests do in fact test the correct behavior (and not
just the behavior we think is correct), it is possible to run the tests against
the host's glibc. The executables are already in your path.

    $ mma
    $ bionic-unit-tests-glibc32
    $ bionic-unit-tests-glibc64


Gathering test coverage
-----------------------

For either host or target coverage, you must first:

 * `$ export NATIVE_COVERAGE=true`
     * Note that the build system is ignorant to this flag being toggled, i.e. if
       you change this flag, you will have to manually rebuild bionic.
 * Set `bionic_coverage=true` in `libc/Android.mk` and `libm/Android.mk`.

### Coverage from device tests

    $ mma
    $ adb sync
    $ adb shell \
        GCOV_PREFIX=/data/local/tmp/gcov \
        GCOV_PREFIX_STRIP=`echo $ANDROID_BUILD_TOP | grep -o / | wc -l` \
        /data/nativetest/bionic-unit-tests/bionic-unit-tests32
    $ acov

`acov` will pull all coverage information from the device, push it to the right
directories, run `lcov`, and open the coverage report in your browser.

### Coverage from host tests

First, build and run the host tests as usual (see above).

    $ croot
    $ lcov -c -d $ANDROID_PRODUCT_OUT -o coverage.info
    $ genhtml -o covreport coverage.info # or lcov --list coverage.info

The coverage report is now available at `covreport/index.html`.


Attaching GDB to the tests
--------------------------

Bionic's test runner will run each test in its own process by default to prevent
tests failures from impacting other tests. This also has the added benefit of
running them in parallel, so they are much faster.

However, this also makes it difficult to run the tests under GDB. To prevent
each test from being forked, run the tests with the flag `--no-isolate`.


32-bit ABI bugs
---------------

This probably belongs in the NDK documentation rather than here, but these
are the known ABI bugs in the 32-bit ABI:

 * `time_t` is 32-bit. <http://b/5819737>. In the 64-bit ABI, time_t is
   64-bit.

 * `off_t` is 32-bit. There is `off64_t`, and in newer releases there is
   almost-complete support for `_FILE_OFFSET_BITS`. Unfortunately our stdio
   implementation uses 32-bit offsets and -- worse -- function pointers to
   functions that use 32-bit offsets, so there's no good way to implement
   the last few pieces <http://b/24807045>. In the 64-bit ABI, off_t is
   off64_t.

 * `sigset_t` is too small on ARM and x86 (but correct on MIPS), so support
   for real-time signals is broken. <http://b/5828899> In the 64-bit ABI,
   `sigset_t` is the correct size for every architecture.
